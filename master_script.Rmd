---
title: "master_script_md"
author: "Savannah McNair"
date: "2025-04-12"
output: html_document
---

#1. Set up a local Spark server and add the two datasets you used in the first assignment from their GitHub repository. (20%)

#prerequisites
had to download java
```{r}
#system("java -version")
#install.packages("sparklyr")
#packageVersion("sparklyr")
library(sparklyr)
#spark_install(version = "3.0")
library(dplyr)
```

#connecting - had to change the version to be the most recent compatible version
```{r}
sc <- spark_connect(master = "local", version = "3.0")
```

#add the two data sets in the first assignment
#csv urls
```{r}
url_lookup <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/UID_ISO_FIPS_LookUp_Table.csv"
url_confirmed <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"
```

#filenames to save locally
```{r}
file_lookup <- "lookup.csv"
file_confirmed <- "confirmed_global.csv"
```

#download the data
```{r}
download.file(url_lookup, destfile = file_lookup, mode = "wb")
download.file(url_confirmed, destfile = file_confirmed, mode = "wb")
```

#load into spark
```{r}
lookup_tbl <- spark_read_csv(sc, name = "lookup_tbl", path = file_lookup, header = TRUE, infer_schema = TRUE)
confirmed_tbl <- spark_read_csv(sc, name = "confirmed_tbl", path = file_confirmed, header = TRUE, infer_schema = TRUE)
```


#2. In Spark, merge the two datasets, make a smaller version that includes only: Germany, China, Japan, United Kingdom, US, Brazil, Mexico and calculate the number of cases and rate of cases (cases/population) by country and day. Do two graphs and interpret them: change in the number of cases and change in rate by country. (25%)

#merge datasets by country/region
```{r}
merged_tbl <- confirmed_tbl %>%
  left_join(lookup_tbl, 
            by = c("CountryRegion" = "Country_Region"))
```

#filter for countries of interest
```{r}
countries <- c("Germany", "China", "Japan", "United Kingdom", "US", "Brazil", "Mexico")

filtered_tbl <- merged_tbl %>%
  filter(`CountryRegion` %in% countries)
```

##NEED TO DO BEFORE STATS: figure out how to make this long format since we need time?

#3. Run a ml_linear_regression explaining the log of number of cases using: country, population size and day since the start of the pandemic. Interpret the results. (25%)

#4. Write up everything in an analytic notebook (pdf Rmarkdown) that shows all the syntax you used, the results and walk the reader through the steps of your analysis. (20%)

#5. Presentation, presentation, presentation: README gives overview of the project and has session info, report text is easy to follow, graphs are easy to understand and properly formatted. (10%)
